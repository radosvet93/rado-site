---
import { formatDate } from '@/utils/data.util';
import PinnedBadge from './PinnedBadge.astro';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import type { PostFrontmatter } from '@/types';

type Props = {
	post: {
		url: string;
		frontmatter: PostFrontmatter;
	};
};

const { post } = Astro.props as Props;
const isPinned = post.frontmatter.isPinned === true;
const img = post.frontmatter.image;

const postImageGlob = import.meta.glob<{ default: ImageMetadata }>(
	'/src/pages/posts/**/*.{jpeg,jpg,png,gif}'
);
const postImage = postImageGlob[img.src];

if (!postImage)
	throw new Error(`"${img.src}" does not exist in glob: "src/pages/posts/**/*.{jpeg,jpg,png,gif}"`);
---

<div>
	<a href={post.url}>
		<div class="h-full rounded-2xl bg-red-200 p-1 text-sm dark:bg-gray-300">
			<div
				class="flex h-full flex-col rounded-2xl bg-white p-4 text-gray-900 opacity-90 dark:bg-gray-900 dark:text-white"
			>
				<div class="">
					<div class="flex flex-col justify-between gap-2 pb-4 text-xs">
						<div class="flex justify-between gap-2">
							{isPinned && <PinnedBadge size="sm" />}

							<strong>{post.frontmatter.minutesRead}</strong>
							<p>{formatDate(post.frontmatter.pubDate)}</p>
						</div>
					</div>
				</div>

				<Image src={postImage()} alt={img.alt} width={700} height={350} />

				<p class="pb-4 text-lg font-bold dark:text-amber-300">{post.frontmatter.title}</p>
				<p class="line-clamp-3">{post.frontmatter.excerpt}</p>
			</div>
		</div>
	</a>
</div>
