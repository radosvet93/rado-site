---
import { formatDate } from '@/utils/data.util';
import PinnedBadge from './PinnedBadge.astro';
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

interface Props {
	post: {
		url: string;
		frontmatter: {
			title: string;
			isPinned: boolean;
			pubDate: string;
			minutesRead: string;
			excerpt: string;
			image: {
				src: string;
				alt: string;
			};
		};
	};
}

const { post } = Astro.props;
const isPinned = post.frontmatter.isPinned === true;
const img = post.frontmatter.image;

const postImageGlob = import.meta.glob<{ default: ImageMetadata }>(
	'/src/pages/posts/**/*.{jpeg,jpg,png,gif}'
);
const postImage = postImageGlob[img.src];

if (!postImage)
	throw new Error(`"${img.src}" does not exist in glob: "src/pages/posts/**/*.{jpeg,jpg,png,gif}"`);
---

<a href={post.url}>
	<div class="h-full rounded-2xl p-1 text-sm dark:bg-red-300">
		<div
			class="flex h-full flex-col rounded-2xl bg-gray-300 p-4 text-gray-900 opacity-90 dark:bg-gray-900 dark:text-white"
		>
			<div class="flex-auto">
				<div class="flex flex-col justify-between gap-2 pb-4 text-xs">
					<div class="flex justify-between gap-2">
						{isPinned && <PinnedBadge size="sm" />}

						<strong>{post.frontmatter.minutesRead}</strong>
						<p>{formatDate(post.frontmatter.pubDate)}</p>
					</div>
				</div>
			</div>

			{img.src ? <Image src={postImage()} alt={img.alt} width={300} height={150} /> : null}

			<p class="pb-4 text-lg font-bold">{post.frontmatter.title}</p>
			<p class="line-clamp-2">{post.frontmatter.excerpt}</p>
		</div>
	</div>
</a>
