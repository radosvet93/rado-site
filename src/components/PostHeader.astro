---
import { formatDate } from '@/utils/data.util';
import Section from './Section.astro';
import Tags from './Tags.astro';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

const { title, pubDate, tags, minutesRead, image, accreditation } = Astro.props;

const postImageGlob = import.meta.glob<{ default: ImageMetadata }>(
	'/src/pages/posts/**/*.{jpeg,jpg,png,gif}'
);
const postImage = postImageGlob[image.src];
const handle = accreditation?.handle;
const photographer = accreditation?.photographer;
const photo = accreditation?.photo;
const media = accreditation?.media;

if (!postImage)
	throw new Error(
		`"${image.src}" does not exist in glob: "src/pages/posts/**/*.{jpeg,jpg,png,gif}"`
	);

const formattedDate = formatDate(pubDate);
---

<Section>
	<div class="flex flex-col items-center">
		<div class="relative px-4 pb-4 text-center sm:px-14 sm:pt-6">
			<h1 class="text-2xl font-bold sm:text-4xl">{title}</h1>
		</div>
		<div class="pb-4">
			<Tags tags={tags} withHref={true} />
		</div>
		<div class="pb-4 text-sm">
			<span>{formattedDate}</span> - <span>{minutesRead}</span>
		</div>

		<Image src={postImage()} alt={image.alt} width={800} height={600} />
		{
			accreditation && (
				<div class="pt-2 text-xs italic opacity-80">
					Photo by
					<a class="underline" href={handle} target="_blank">
						{photographer}
					</a>
					on
					<a class="underline" href={photo} target="_blank">
						{media}
					</a>
				</div>
			)
		}
	</div>
</Section>
